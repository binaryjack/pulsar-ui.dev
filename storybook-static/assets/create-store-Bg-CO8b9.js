const V=function(){this.subscribers.clear()};let y=null;const C=[];function m(){return y}function S(e){C.push(y),y=e}function k(){y=C.pop()??null}const F=function(){const e=m();if(e){const t=e;this.subscribers.add(t.boundExecute),e.addDependency(this)}return this._value},A=function(e){return this.subscribers.add(e),()=>{this.unsubscribe(e)}},T=function(e){this.subscribers.delete(e)},h=function(){},c={isBatching:!1,pendingEffects:new Set,depth:0},G=function(){c.depth--,c.depth===0&&(c.isBatching=!1,this.flush()),c.depth<0&&(c.depth=0)},H=function(){const e=Array.from(c.pendingEffects);c.pendingEffects.clear(),e.forEach(t=>{try{t()}catch(n){console.error("[pulsar] Error during batch flush:",n)}})},z=function(){return c.isBatching},N=function(e){c.isBatching?c.pendingEffects.add(e):e()},W=function(){c.depth++,c.depth===1&&(c.isBatching=!0)};h.prototype.start=W;h.prototype.end=G;h.prototype.schedule=N;h.prototype.isBatching=z;h.prototype.flush=H;let w=null;function Q(){return w||(w=new h),w}const X=Q();function q(e){X.schedule(e)}const J=function(e){var t;const n=this,s=typeof e=="function"?e(n._value):e;if((t=this.options)!=null&&t.equals){if(this.options.equals(n._value,s))return}else if(Object.is(n._value,s))return;n._value=s,this.subscribers.forEach(r=>{q(r)})},M=function(e,t){Object.defineProperty(this,"_value",{value:e,writable:!0,configurable:!1,enumerable:!1}),Object.defineProperty(this,"subscribers",{value:new Set,writable:!1,configurable:!1,enumerable:!1}),t&&Object.defineProperty(this,"options",{value:t,writable:!1,configurable:!1,enumerable:!1})};Object.assign(M.prototype,{read:F,write:J,subscribe:A,unsubscribe:T,dispose:V});function u(e,t){const n=new M(e,t);return[()=>n.read(),s=>n.write(s)]}const K=function(e){this.dependencies.add(e)},Y=function(){const e=this,t=e.cleanupFn;t!=null&&(typeof t=="function"&&t(),e.cleanupFn=void 0)},Z=function(){this.cleanup(),this.dependencies.forEach(e=>{"unsubscribe"in e&&typeof e.unsubscribe=="function"&&e.unsubscribe(this.execute.bind(this))}),this.dependencies.clear()},ee=function(){this.cleanup();const e=new Set,t=this;t.dependencies=e,S(this);try{const n=this.fn();typeof n=="function"?t.cleanupFn=n:t.cleanupFn=void 0}finally{k()}},D=function(e){Object.defineProperty(this,"fn",{value:e,writable:!1,configurable:!1,enumerable:!1});const t=this;t.dependencies=new Set,Object.defineProperty(this,"boundExecute",{value:this.execute.bind(this),writable:!1,configurable:!1,enumerable:!1})};Object.assign(D.prototype,{execute:ee,addDependency:K,cleanup:Y,dispose:Z});function te(e){const t=new D(e);return t.execute(),()=>t.dispose()}const ne=function(){const e=this;e.cachedValue=void 0,e.isDirty=!0},se=function(){const e=this;e.isDirty=!0},re=function(){this.subscribers.forEach(e=>e())},ie=function(){if(this.isDirty||this.cachedValue===void 0){const e=this;e.signalUnsubscribes&&(e.signalUnsubscribes.forEach(n=>n()),e.signalUnsubscribes=[]),e.dependencies.clear();const t=m();S({execute:()=>{},boundExecute:()=>{},addDependency:n=>{e.dependencies.add(n);const s=n.subscribe(()=>{e.isDirty=!0});if(e.signalUnsubscribes||(e.signalUnsubscribes=[]),e.signalUnsubscribes.push(s),t){t.addDependency(n);const r=t;(!("subscribers"in n)||!n.subscribers.has(r.boundExecute))&&n.subscribe(r.boundExecute)}}});try{e.cachedValue=this.computeFn(),e.isDirty=!1}finally{k()}}else if(m()){const e=m();if(e){const t=this,n=e;t.dependencies.forEach(s=>{e.addDependency(s),(!("subscribers"in s)||!s.subscribers.has(n.boundExecute))&&s.subscribe(n.boundExecute)})}}return this.cachedValue},oe=function(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}},L=function(e){Object.defineProperty(this,"computeFn",{value:e,writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(this,"isDirty",{value:!0,writable:!0,configurable:!1,enumerable:!1}),Object.defineProperty(this,"dependencies",{value:new Set,writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(this,"subscribers",{value:new Set,writable:!1,configurable:!1,enumerable:!1})};Object.assign(L.prototype,{read:ie,invalidate:se,dispose:ne,subscribe:oe,notify:re});function ae(e){const t=new L(e);return()=>t.read()}var O={};const P={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function j(e){if(typeof import.meta<"u"&&P)return P[e];if(typeof process<"u"&&O)return O[e]}function le(){const e=j("MODE")||j("NODE_ENV")||"development";return e==="test"||e==="testing"?"test":e==="production"||e==="prod"?"production":"development"}const ce={get MODE(){return le()},get DEV(){return this.MODE==="development"}};function ue(){return ce.DEV}ue();const fe=function(){return this.nativeEvent.defaultPrevented},he=function(){return this.nativeEvent.cancelBubble},pe=function(){this.cancelable&&this.nativeEvent.preventDefault()},be=function(){this.nativeEvent.stopImmediatePropagation()},de=function(){this.nativeEvent.stopPropagation()},R=function(e){Object.defineProperty(this,"nativeEvent",{value:e,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"type",{value:e.type,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"target",{value:e.target,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"currentTarget",{value:e.currentTarget,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"timeStamp",{value:e.timeStamp,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"bubbles",{value:e.bubbles,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"cancelable",{value:e.cancelable,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"defaultPrevented",{value:e.defaultPrevented,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"eventPhase",{value:e.eventPhase,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"isTrusted",{value:e.isTrusted,writable:!1,configurable:!1,enumerable:!0})};Object.assign(R.prototype,{preventDefault:pe,stopPropagation:de,stopImmediatePropagation:be,isPropagationStopped:he,isDefaultPrevented:fe});function x(e){return new R(e)}const ge=function(e,t,n,s){this.handlers.has(e)||this.handlers.set(e,new Map),this.cleanupFunctions.has(e)||this.cleanupFunctions.set(e,new Map);const r=this.handlers.get(e),o=this.cleanupFunctions.get(e),a=f=>{const b=x(f);n(b)};r.set(t,n),e.addEventListener(t,a,s);const l=()=>{e.removeEventListener(t,a,s),r.delete(t),o.delete(t)};return o.set(t,l),l},me=function(e,t){const n=this.handlers.get(e);return n?n.has(t):!1},ye=function(e){const t=this.cleanupFunctions.get(e);t&&(t.forEach(n=>n()),t.clear()),this.handlers.delete(e),this.cleanupFunctions.delete(e)},we=function(e,t){const n=this.cleanupFunctions.get(e);if(n){const s=n.get(t);s&&s()}},ve=function(){Object.defineProperty(this,"handlers",{value:new WeakMap,writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(this,"cleanupFunctions",{value:new WeakMap,writable:!1,configurable:!1,enumerable:!1})};Object.assign(ve.prototype,{addEventListener:ge,removeEventListener:we,removeAllListeners:ye,hasListener:me});function Ee(e,t){return te(e)}function dt(e){return u(e)}const i=function(){Object.defineProperty(this,"currentPathSignal",{value:u("/"),writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(this,"currentParamsSignal",{value:u({}),writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(this,"currentQuerySignal",{value:u(null),writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(this,"currentRouteSignal",{value:u(null),writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(this,"currentMatchSignal",{value:u(null),writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(this,"beforeGuards",{value:[],writable:!0,enumerable:!1,configurable:!1}),Object.defineProperty(this,"afterGuards",{value:[],writable:!0,enumerable:!1,configurable:!1}),Object.defineProperty(this,"routes",{value:[],writable:!0,enumerable:!1,configurable:!1}),$e.call(this)};function $e(){const e=()=>{Oe.call(this)};window.addEventListener("hashchange",e),window.addEventListener("popstate",e)}function Oe(){const e=I.call(this);this.currentPathSignal[1](e)}function I(){return window.location.hash?window.location.hash.slice(1)||"/":window.location.pathname}Object.defineProperty(i.prototype,"currentPath",{get(){return this.currentPathSignal[0]()},enumerable:!0,configurable:!1});Object.defineProperty(i.prototype,"currentParams",{get(){return this.currentParamsSignal[0]()},enumerable:!0,configurable:!1});Object.defineProperty(i.prototype,"currentQuery",{get(){return this.currentQuerySignal[0]()},enumerable:!0,configurable:!1});Object.defineProperty(i.prototype,"currentRoute",{get(){return this.currentRouteSignal[0]()},enumerable:!0,configurable:!1});Object.defineProperty(i.prototype,"currentMatch",{get(){return this.currentMatchSignal[0]()},enumerable:!0,configurable:!1});i.prototype.getLocation=function(){return{pathname:window.location.pathname,search:window.location.search,hash:window.location.hash,href:window.location.href}};i.prototype.navigate=async function(e,t){const n=I.call(this);for(const{guard:s}of this.beforeGuards)if(await s(e,n)===!1)return;t!=null&&t.replace?window.location.replace(`#${e}`):window.location.hash=e,this.afterGuards.forEach(s=>s(e,n))};i.prototype.beforeEach=function(e){const t={guard:e};return this.beforeGuards.push(t),()=>{const n=this.beforeGuards.indexOf(t);n>-1&&this.beforeGuards.splice(n,1)}};i.prototype.afterEach=function(e){return this.afterGuards.push(e),()=>{const t=this.afterGuards.indexOf(e);t>-1&&this.afterGuards.splice(t,1)}};i.prototype.setParams=function(e){this.currentParamsSignal[1](e)};i.prototype.setQuery=function(e){this.currentQuerySignal[1](e)};i.prototype.setRoute=function(e){this.currentRouteSignal[1](e)};i.prototype.setMatch=function(e){this.currentMatchSignal[1](e)};i.prototype.registerRoutes=function(e){this.routes=e};i.prototype.getRoutes=function(){return this.routes};let v=null;function Pe(){return v||(v=new i),v}Pe();const je=function(e,t){this.cleanupCallbacks.has(e)||this.cleanupCallbacks.set(e,[]),this.cleanupCallbacks.get(e).push(t)},_e=function(e,t){this.mountCallbacks.has(e)||this.mountCallbacks.set(e,[]),this.mountCallbacks.get(e).push(t)},Ce=function(e,t){this.updateCallbacks.has(e)||this.updateCallbacks.set(e,[]),this.updateCallbacks.get(e).push(t)},Se=function(e){const t=this.cleanupCallbacks.get(e);t&&(t.forEach(n=>n()),t.length=0),this.mountCallbacks.delete(e),this.cleanupCallbacks.delete(e),this.updateCallbacks.delete(e)},ke=function(e){const t=this.mountCallbacks.get(e);t&&t.forEach(n=>{const s=n();typeof s=="function"&&this.onCleanup(e,s)})},Me=function(e){const t=this.updateCallbacks.get(e);t&&t.forEach(n=>{const s=n();typeof s=="function"&&this.onCleanup(e,s)})},De=function(){Object.defineProperty(this,"mountCallbacks",{value:new WeakMap,writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(this,"cleanupCallbacks",{value:new WeakMap,writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(this,"updateCallbacks",{value:new WeakMap,writable:!1,configurable:!1,enumerable:!1})};Object.assign(De.prototype,{onMount:_e,onCleanup:je,onUpdate:Ce,runMount:ke,runCleanup:Se,runUpdate:Me});const p=function(e){Object.defineProperty(this,"config",{value:e,writable:!0,enumerable:!1}),Object.defineProperty(this,"_rootElement",{value:null,writable:!0,enumerable:!1}),Object.defineProperty(this,"_componentElement",{value:null,writable:!0,enumerable:!1}),Object.defineProperty(this,"_isMounted",{value:!1,writable:!0,enumerable:!1})};Object.defineProperty(p.prototype,"rootElement",{get(){if(!this._rootElement)throw new Error("Application not initialized. Call mount() first.");return this._rootElement},enumerable:!0,configurable:!1});Object.defineProperty(p.prototype,"componentElement",{get(){return this._componentElement},enumerable:!0,configurable:!1});function Le(){for(const[e,t]of this.registry.entries()){const n=this.metadata.get(t.element);n!=null&&n.cleanup&&n.cleanup()}this.registry.clear(),this.parentChildren.clear()}function Re(e){return this.registry.get(e)}function xe(e){const t=this.parentChildren.get(e);return t?Array.from(t):[]}function Ie(e){return this.registry.has(e)}function Be(e,t,n){if(!e||typeof e!="string")throw new Error("Element ID must be a non-empty string");if(!(t instanceof HTMLElement))throw new Error("Element must be an HTMLElement instance");if(this.registry.has(e))throw new Error(`Element with ID "${e}" is already registered`);this.registry.set(e,n),this.metadata.set(t,{effects:new Set,signals:new Set}),n.parentId&&(this.parentChildren.has(n.parentId)||this.parentChildren.set(n.parentId,new Set),this.parentChildren.get(n.parentId).add(e))}function Ue(){return this.registry.size}function Ve(e){const t=this.registry.get(e);if(!t)return;const n=this.metadata.get(t.element);if(n!=null&&n.cleanup&&n.cleanup(),t.parentId){const s=this.parentChildren.get(t.parentId);s&&(s.delete(e),s.size===0&&this.parentChildren.delete(t.parentId))}this.registry.delete(e)}function Fe(e){const t=[],n=[e];for(;n.length>0;){const s=n.shift();t.push(s);const r=this.getChildren(s);n.push(...r)}for(const s of t)this.unregister(s)}const Ae=function(){Object.defineProperty(this,"registry",{value:new Map,writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(this,"metadata",{value:new WeakMap,writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(this,"parentChildren",{value:new Map,writable:!1,configurable:!1,enumerable:!1})};Object.assign(Ae.prototype,{register:Be,unregister:Ve,get:Re,has:Ie,getChildren:xe,unregisterSubtree:Fe,clear:Le,size:Ue});const Te=function(){Array.from(this.nativeListeners.keys()).forEach(e=>{this.stopDelegation(e)}),this.handlers.clear()},Ge=function(e,t,n,s){return this.handlers.has(e)||this.handlers.set(e,new Map),this.handlers.get(e).set(t,{handler:n,options:s}),this.startDelegation(t),()=>this.unregisterHandler(e,t)},He=function(e){var t;if(this.nativeListeners.has(e))return;const n=o=>{let a=o.target;for(;a&&a!==this.appRoot.rootElement;){const l=a.__elementId;if(l){const f=this.handlers.get(l),b=f==null?void 0:f.get(e);if(b){const{handler:B,options:d}=b,U=d!=null&&d.synthetic?x(o):o;try{B(U)}catch($){this.appRoot.onError?this.appRoot.onError($):console.error("Event handler error:",$)}if(o.cancelBubble)break;d!=null&&d.once&&this.unregisterHandler(l,e)}}a=a.parentElement}};let s=!1;for(const o of this.handlers.values()){const a=o.get(e);if(a){s=((t=a.options)==null?void 0:t.capture)||!1;break}}this.appRoot.rootElement.addEventListener(e,n,{capture:s});const r=()=>{this.appRoot.rootElement.removeEventListener(e,n,{capture:s})};this.nativeListeners.set(e,r)},ze=function(e){const t=this.nativeListeners.get(e);t&&(t(),this.nativeListeners.delete(e))},Ne=function(e){const t=this.handlers.get(e);t&&Array.from(t.keys()).forEach(n=>{this.unregisterHandler(e,n)})},We=function(e,t){const n=this.handlers.get(e);n&&(n.delete(t),n.size===0&&this.handlers.delete(e));let s=!1;for(const r of this.handlers.values())if(r.has(t)){s=!0;break}s||this.stopDelegation(t)},Qe=function(e){Object.defineProperty(this,"appRoot",{value:e,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"handlers",{value:new Map,writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(this,"nativeListeners",{value:new Map,writable:!1,configurable:!1,enumerable:!1})};Object.assign(Qe.prototype,{registerHandler:Ge,unregisterHandler:We,unregisterElement:Ne,startDelegation:He,stopDelegation:ze,destroy:Te});const Xe=function(){Object.defineProperty(this,"stack",{value:[],writable:!1,enumerable:!0})};function qe(e){this.stack.push(e)}function Je(){return this.stack.pop()}function Ke(){return this.stack[this.stack.length-1]}function Ye(){const e=this.stack.length;return e>=2?this.stack[e-2]:void 0}function Ze(e){return this.stack.find(t=>t.elementId===e)}function et(e){const t=[],n=this.find(e);if(!n)return t;let s=n;for(;s&&(t.unshift(s),s.parentId);)s=this.find(s.parentId);return t}function tt(){this.stack.length=0}function nt(){return this.stack.length}Object.assign(Xe.prototype,{push:qe,pop:Je,current:Ke,parent:Ye,find:Ze,getLogicalChain:et,clear:tt,size:nt});const E=function(e){Object.defineProperty(this,"_element",{value:e,writable:!1,enumerable:!1}),Object.defineProperty(this,"_currentComponent",{value:null,writable:!0,enumerable:!1})};Object.defineProperty(E.prototype,"element",{get(){return this._element},enumerable:!0,configurable:!1});const st=function(){if(this._isMounted){console.warn("[Bootstrap] Application already mounted");return}try{if(typeof this.config.root=="string"){const t=document.querySelector(this.config.root);if(!t)throw new Error(`Root element not found: ${this.config.root}`);this._rootElement=t}else this._rootElement=this.config.root;this._componentElement=this.config.component(this.config.props);let e=this._componentElement;this.config.wrapper&&(e=this.config.wrapper({children:this._componentElement})),this._rootElement.innerHTML="",this._rootElement.appendChild(e),this._isMounted=!0,this.config.onMount&&this.config.onMount(this._componentElement),console.log("[Bootstrap] Application mounted successfully")}catch(e){const t=e;if(console.error("[Bootstrap] Mount failed:",t),this.config.onError)this.config.onError(t);else throw t}},rt=function(){if(!this._isMounted){console.warn("[Bootstrap] Application not mounted");return}try{this.config.onUnmount&&this.config.onUnmount(),this._rootElement&&this._componentElement&&this._rootElement.removeChild(this._componentElement),this._componentElement=null,this._isMounted=!1,console.log("[Bootstrap] Application unmounted")}catch(e){console.error("[Bootstrap] Unmount failed:",e)}},it=function(e){if(!this._isMounted)throw new Error("Cannot update unmounted application");this.config.props=e,this.unmount(),this.mount()};p.prototype.mount=st;p.prototype.unmount=rt;p.prototype.update=it;const ot=function(){this._currentComponent&&(this._element.removeChild(this._currentComponent),this._currentComponent=null)},at=function(e,t){this.clear(),this._currentComponent=e(t),this._element.appendChild(this._currentComponent)};E.prototype.render=at;E.prototype.clear=ot;const lt=new Map,g=new Map,_=new Map;function ct(e){const t=Symbol("Context"),[n,s]=u(e);return lt.set(t,[n,s]),{Provider:({value:r,children:o})=>{g.has(t)||g.set(t,[]),g.get(t).push(r),s(r);const a=_.get(t);return a&&a.size>0&&(a.forEach(l=>{l(r)}),_.delete(t)),Ee(()=>()=>{const l=g.get(t);if(l&&l.length>0)if(l.pop(),l.length>0){const f=l[l.length-1];s(f)}else s(e)}),typeof o=="function"?o():o},defaultValue:e,_id:t,setValue:r=>{console.log("[Context setValue] Setting value:",r,"for context:",t),s(r),console.log("[Context setValue] Signal now returns:",n())}}}ct({appName:"Pulsar App",version:"1.0.0",theme:"light"});const ut=function(e){const t=this.state;let n=s=>{this.state=this.reducer(this.state,s),this.devtools&&this.devtools.send(s,this.state)};if(this.middleware&&this.middleware.length>0){const s={getState:()=>this.state,dispatch:r=>this.dispatch(r)};n=this.middleware.map(r=>r(s)).reduceRight((r,o)=>o(r),n)}n(e),this.state!==t&&this.subscribers.forEach(s=>s(this.state))},ft=function(){return this.state},ht=function(e){const[t,n]=u(this.state);return this.subscribe(s=>{n(s)}),ae(()=>e(t()))},pt=function(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}},bt=function(e,t,n,s){if(Object.defineProperty(this,"state",{value:e,writable:!0,enumerable:!1,configurable:!1}),Object.defineProperty(this,"reducer",{value:t,writable:!1,enumerable:!1,configurable:!1}),n&&n.length>0&&Object.defineProperty(this,"middleware",{value:n,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(this,"subscribers",{value:new Set,writable:!1,enumerable:!1,configurable:!1}),s!=null&&s.devtools&&typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION__){const r=window.__REDUX_DEVTOOLS_EXTENSION__.connect({name:s.name||"Pulsar Store",trace:s.trace,traceLimit:s.traceLimit||25});r.init(e),Object.defineProperty(this,"devtools",{value:r,writable:!1,enumerable:!1,configurable:!1})}};Object.assign(bt.prototype,{getState:ft,dispatch:ut,subscribe:pt,select:ht});export{Ee as c,dt as p,ae as t};
