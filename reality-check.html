<!doctype html>
<html>
  <head>
    <title>BRUTAL REALITY CHECK</title>
    <style>
      body {
        background: #000;
        color: #0f0;
        font-family: monospace;
        padding: 20px;
      }
      .log {
        margin: 2px 0;
      }
      .error {
        color: #f00;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>BRUTAL REALITY CHECK - WHAT'S ACTUALLY HAPPENING?</h1>
    <div id="logs"></div>
    <hr />
    <div id="app" style="border: 2px solid red; min-height: 200px; padding: 20px">
      <p style="color: yellow">üëÜ APP CONTAINER - Should have content below:</p>
    </div>

    <script type="module">
      const logs = document.getElementById('logs');
      const log = (msg, isError = false) => {
        const div = document.createElement('div');
        div.className = 'log' + (isError ? ' error' : '');
        div.textContent = `${new Date().toISOString().split('T')[1]} ${msg}`;
        logs.appendChild(div);
        console.log(msg);
      };

      log('‚ñ∂ REALITY CHECK STARTED');

      try {
        log('1. Importing pulsar runtime...');
        const pulsar = await import('@pulsar-framework/pulsar.dev');
        log(`2. ‚úÖ Runtime loaded, keys: ${Object.keys(pulsar).slice(0, 10).join(', ')}`);

        log('3. Checking $REGISTRY...');
        if (!pulsar.$REGISTRY) {
          log('‚ùå NO $REGISTRY!', true);
          throw new Error('$REGISTRY not found');
        }
        log(`4. ‚úÖ $REGISTRY exists, typeof: ${typeof pulsar.$REGISTRY}`);

        log('5. Importing PSR component...');
        const { AvatarTest } = await import('./src/test-psr-avatar.psr');
        log(`6. ‚úÖ AvatarTest imported, typeof: ${typeof AvatarTest}`);

        log('7. Calling AvatarTest()...');
        const result = AvatarTest();
        log(`8. ‚úÖ AvatarTest() returned: ${typeof result}, result: ${result}`);

        if (!result) {
          log('‚ùå RESULT IS NULL/UNDEFINED', true);
        } else if (result.nodeType) {
          log(`9. ‚úÖ Result is a DOM node (nodeType: ${result.nodeType})`);
          log('10. Appending to #app...');
          document.getElementById('app').appendChild(result);
          log('11. ‚úÖ APPENDED! Check the red box above.');
        } else {
          log(`9. ‚ùå Result is NOT a DOM node: ${JSON.stringify(result)}`, true);
        }

        log('12. Checking if #app has children...');
        const appChildren = document.getElementById('app').children.length;
        log(`13. #app has ${appChildren} children (should be 2: yellow p + component)`);
      } catch (err) {
        log(`‚ùå‚ùå‚ùå FATAL ERROR: ${err.message}`, true);
        log(`Stack: ${err.stack}`, true);
      }
    </script>
  </body>
</html>
