/**
 * COMPREHENSIVE Error Boundaries Demo with Maximum Visual Feedback
 */

import { createSignal, Tryer, Catcher } from '@pulsar-framework/pulsar.dev';

// Components that can throw errors
component SafeComponent({ title = "Safe Component" }) {
  return (
    <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 12px; color: white; border: 2px solid #065f46;">
      <div style="font-size: 48px; margin-bottom: 15px;">âœ¨</div>
      <h3 style="margin: 0 0 10px 0; font-size: 20px;">{title} Working!</h3>
      <p style="margin: 0; opacity: 0.9; font-size: 14px;">All systems operational</p>
    </div>
  );
}

component ErrorComponent({ message, title = "Error Component" }) {
  const errorMsg = typeof message === 'function' ? message() : message;
  throw new Error(errorMsg || `${title} rendering failed!`);
}

// Visual Error Boundary Wrapper
component VisualErrorBoundary({ children, title, borderColor = "#06b6d4" }) {
  return (
    <div style="background: #1e293b; padding: 25px; border-radius: 12px; border: 3px solid {borderColor}; position: relative; margin-bottom: 30px;">
      <h3 style="color: {borderColor}; margin-bottom: 20px; text-align: center; font-size: 18px;">
        ğŸ›¡ï¸ {title}
      </h3>
      
      <div style="background: #0f172a; border-radius: 8px; padding: 20px; min-height: 150px; border: 2px dashed #475569;">
        <Tryer>
          {children}
          
          <Catcher>
            {(error, reset) => (
              <div style="background: linear-gradient(135deg, #7f1d1d, #991b1b); border: 3px solid #ef4444; border-radius: 12px; padding: 25px; text-align: center; box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);">
                <div style="font-size: 48px; margin-bottom: 15px; animation: bounce 1s infinite;">âš ï¸</div>
                
                <h2 style="color: #fca5a5; margin-bottom: 15px; font-size: 22px; font-weight: bold;">
                  ğŸš¨ {title.toUpperCase()} - ERROR CAUGHT!
                </h2>
                
                <div style="background: #450a0a; border: 2px solid #fca5a5; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                  <p style="color: #fecaca; font-family: 'Courier New', monospace; font-size: 14px; margin: 0; word-break: break-word;">
                    ğŸ’¥ "{error.message}"
                  </p>
                </div>
                
                <button
                  onclick={() => {
                    console.log(`${title} - Reset button clicked`);
                    reset();
                  }}
                  style="padding: 12px 24px; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 16px; font-weight: bold; transform: scale(1); transition: all 0.2s; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);"
                >
                  ğŸ”„ RESET {title.toUpperCase()}
                </button>
              </div>
            )}
          </Catcher>
        </Tryer>
      </div>
      
      <div style="position: absolute; top: -12px; right: 20px; background: {borderColor}; color: white; padding: 6px 12px; border-radius: 16px; font-size: 11px; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
        BOUNDARY ACTIVE
      </div>
    </div>
  );
}

export component ErrorBoundaryFullDemoPage() {
  // Individual error states for each section
  const [basicError, setBasicError] = createSignal(false);
  const [section1Error, setSection1Error] = createSignal(false);
  const [section2Error, setSection2Error] = createSignal(false);
  const [section3Error, setSection3Error] = createSignal(false);
  const [nestedOuterError, setNestedOuterError] = createSignal(false);
  const [nestedInnerError, setNestedInnerError] = createSignal(false);
  
  return (
    <div style="padding: 20px; background: linear-gradient(135deg, #0f172a, #1e293b); color: white; min-height: 100vh;">
      {/* Main Header */}
      <div style="text-align: center; margin-bottom: 40px;">
        <h1 style="color: #06b6d4; margin-bottom: 15px; font-size: 42px; text-shadow: 0 0 20px rgba(6, 182, 212, 0.3);">
          ğŸ›¡ï¸ ERROR BOUNDARIES MEGA DEMO
        </h1>
        <p style="color: #94a3b8; font-size: 18px; margin: 0; max-width: 600px; margin: 0 auto;">
          Watch how error boundaries protect your app from crashes with <strong>MASSIVE VISUAL FEEDBACK!</strong>
        </p>
      </div>

      <div style="max-width: 1000px; margin: 0 auto;">
        
        {/* Master Control Panel */}
        <div style="background: linear-gradient(135deg, #1a1a1a, #2d2d2d); padding: 30px; border-radius: 16px; margin-bottom: 40px; border: 3px solid #fbbf24; box-shadow: 0 8px 32px rgba(251, 191, 36, 0.1);">
          <h2 style="color: #fbbf24; margin-bottom: 25px; text-align: center; font-size: 28px; text-shadow: 0 0 10px rgba(251, 191, 36, 0.3);">
            ğŸ® MASTER CONTROL PANEL
          </h2>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
            <button 
              onclick={() => setBasicError(!basicError())}
              style="padding: 15px; background: linear-gradient(135deg, #ef4444, #dc2626); border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.2s; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);"
            >
              {basicError() ? 'ğŸ”§ FIX BASIC' : 'ğŸ’¥ BREAK BASIC'}
            </button>

            <button 
              onclick={() => setSection1Error(!section1Error())}
              style="padding: 15px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.2s; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);"
            >
              {section1Error() ? 'ğŸ”§ FIX SECTION 1' : 'ğŸ’¥ BREAK SECTION 1'}
            </button>

            <button 
              onclick={() => setSection2Error(!section2Error())}
              style="padding: 15px; background: linear-gradient(135deg, #06b6d4, #0891b2); border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.2s; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);"
            >
              {section2Error() ? 'ğŸ”§ FIX SECTION 2' : 'ğŸ’¥ BREAK SECTION 2'}
            </button>

            <button 
              onclick={() => setSection3Error(!section3Error())}
              style="padding: 15px; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.2s; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);"
            >
              {section3Error() ? 'ğŸ”§ FIX SECTION 3' : 'ğŸ’¥ BREAK SECTION 3'}
            </button>

            <button 
              onclick={() => setNestedOuterError(!nestedOuterError())}
              style="padding: 15px; background: linear-gradient(135deg, #f59e0b, #d97706); border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.2s; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);"
            >
              {nestedOuterError() ? 'ğŸ”§ FIX OUTER' : 'ğŸ’¥ BREAK OUTER'}
            </button>

            <button 
              onclick={() => setNestedInnerError(!nestedInnerError())}
              style="padding: 15px; background: linear-gradient(135deg, #ec4899, #db2777); border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.2s; box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);"
            >
              {nestedInnerError() ? 'ğŸ”§ FIX INNER' : 'ğŸ’¥ BREAK INNER'}
            </button>
          </div>
          
          {/* Status Dashboard */}
          <div style="background: #0a0a0a; border: 2px solid #374151; border-radius: 8px; padding: 20px;">
            <h3 style="color: #94a3b8; margin-bottom: 15px; text-align: center; font-size: 16px;">ğŸ¯ SYSTEM STATUS DASHBOARD</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; text-align: center; font-size: 12px;">
              <div style="color: {basicError() ? '#ef4444' : '#10b981'}; font-weight: bold;">
                Basic: {basicError() ? 'ğŸ”¥ ERROR' : 'âœ… OK'}
              </div>
              <div style="color: {section1Error() ? '#ef4444' : '#10b981'}; font-weight: bold;">
                Section 1: {section1Error() ? 'ğŸ”¥ ERROR' : 'âœ… OK'}
              </div>
              <div style="color: {section2Error() ? '#ef4444' : '#10b981'}; font-weight: bold;">
                Section 2: {section2Error() ? 'ğŸ”¥ ERROR' : 'âœ… OK'}
              </div>
              <div style="color: {section3Error() ? '#ef4444' : '#10b981'}; font-weight: bold;">
                Section 3: {section3Error() ? 'ğŸ”¥ ERROR' : 'âœ… OK'}
              </div>
              <div style="color: {nestedOuterError() ? '#ef4444' : '#10b981'}; font-weight: bold;">
                Outer: {nestedOuterError() ? 'ğŸ”¥ ERROR' : 'âœ… OK'}
              </div>
              <div style="color: {nestedInnerError() ? '#ef4444' : '#10b981'}; font-weight: bold;">
                Inner: {nestedInnerError() ? 'ğŸ”¥ ERROR' : 'âœ… OK'}
              </div>
            </div>
          </div>
        </div>

        {/* Basic Error Boundary */}
        <VisualErrorBoundary title="BASIC ERROR BOUNDARY" borderColor="#06b6d4">
          {() => {
            if (basicError()) {
              return <ErrorComponent message={() => 'Basic component crashed!'} title="Basic Component" />;
            } else {
              return <SafeComponent title="Basic Component" />;
            }
          }}
        </VisualErrorBoundary>

        {/* Multiple Independent Boundaries */}
        <div style="background: #1a1a1a; padding: 30px; border-radius: 16px; margin-bottom: 30px; border-left: 6px solid #8b5cf6;">
          <h2 style="color: #8b5cf6; margin-bottom: 25px; text-align: center; font-size: 24px;">
            ğŸ­ MULTIPLE INDEPENDENT BOUNDARIES
          </h2>
          <p style="text-align: center; color: #94a3b8; margin-bottom: 25px; font-size: 16px;">
            Each boundary operates independently - errors in one don't affect others!
          </p>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <VisualErrorBoundary title="SECTION 1" borderColor="#8b5cf6">
              {() => {
                if (section1Error()) {
                  return <ErrorComponent message={() => 'Section 1 exploded!'} title="Section 1" />;
                } else {
                  return <SafeComponent title="Section 1" />;
                }
              }}
            </VisualErrorBoundary>

            <VisualErrorBoundary title="SECTION 2" borderColor="#06b6d4">
              {() => {
                if (section2Error()) {
                  return <ErrorComponent message={() => 'Section 2 crashed!'} title="Section 2" />;
                } else {
                  return <SafeComponent title="Section 2" />;
                }
              }}
            </VisualErrorBoundary>

            <VisualErrorBoundary title="SECTION 3" borderColor="#10b981">
              {() => {
                if (section3Error()) {
                  return <ErrorComponent message={() => 'Section 3 failed!'} title="Section 3" />;
                } else {
                  return <SafeComponent title="Section 3" />;
                }
              }}
            </VisualErrorBoundary>
          </div>
        </div>

        {/* Nested Boundaries */}
        <div style="background: #1a1a1a; padding: 30px; border-radius: 16px; margin-bottom: 30px; border-left: 6px solid #f59e0b;">
          <h2 style="color: #f59e0b; margin-bottom: 25px; text-align: center; font-size: 24px;">
            ğŸ¯ NESTED ERROR BOUNDARIES
          </h2>
          <p style="text-align: center; color: #94a3b8; margin-bottom: 25px; font-size: 16px;">
            Inner boundaries catch first, outer boundary as fallback!
          </p>

          <VisualErrorBoundary title="OUTER BOUNDARY" borderColor="#f59e0b">
            {() => {
              if (nestedOuterError()) {
                return <ErrorComponent message={() => 'Outer component failed!'} title="Outer Component" />;
              } else {
                return (
                  <div style="padding: 20px;">
                    <VisualErrorBoundary title="INNER BOUNDARY" borderColor="#ec4899">
                      {() => {
                        if (nestedInnerError()) {
                          return <ErrorComponent message={() => 'Inner component failed!'} title="Inner Component" />;
                        } else {
                          return <SafeComponent title="Nested Inner Component" />;
                        }
                      }}
                    </VisualErrorBoundary>
                  </div>
                );
              }
            }}
          </VisualErrorBoundary>
        </div>

        {/* Instructions */}
        <div style="background: linear-gradient(135deg, #1f2937, #374151); padding: 30px; border-radius: 16px; border: 3px solid #10b981; text-align: center;">
          <h2 style="color: #10b981; margin-bottom: 20px; font-size: 24px;">
            ğŸ‰ NOW THIS IS VISUAL FEEDBACK!
          </h2>
          <div style="color: #94a3b8; font-size: 16px; line-height: 1.8; max-width: 700px; margin: 0 auto;">
            <p><strong style="color: white;">Click any "BREAK" button</strong> â†’ Watch the massive error displays appear!</p>
            <p><strong style="color: white;">Multiple errors</strong> â†’ Each boundary shows its own giant error message!</p>
            <p><strong style="color: white;">Independent operation</strong> â†’ Breaking one doesn't affect others!</p>
            <p><strong style="color: white;">Recovery</strong> â†’ Each boundary has its own reset button!</p>
          </div>
        </div>

      </div>
    </div>
  );
}