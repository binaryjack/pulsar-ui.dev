/**
 * Edge Case 3: Conditionals - PSR Version
 * Testing conditional rendering with RenderCapture validation
 */

import { useState, useEffect } from '@pulsar-framework/pulsar.dev';
import { captureRender, compareWithExpected } from '../tests/render-capture';

// Component A
component ComponentA() {
  return (
    <div style="padding: 2rem; background: #c6f6d5; border-radius: 12px; border-left: 4px solid #48bb78;">
      <h2 style="margin: 0 0 0.5rem; color: #22543d;">‚úÖ Component A</h2>
      <p style="margin: 0; color: #276749;">This component is rendered when condition is TRUE</p>
    </div>
  );
}

// Component B
component ComponentB() {
  return (
    <div style="padding: 2rem; background: #fed7d7; border-radius: 12px; border-left: 4px solid #fc8181;">
      <h2 style="margin: 0 0 0.5rem; color: #742a2a;">‚ùå Component B</h2>
      <p style="margin: 0; color: #9b2c2c;">This component is rendered when condition is FALSE</p>
    </div>
  );
}

// Loading component
component LoadingSpinner() {
  return (
    <div style="padding: 2rem; background: #bee3f8; border-radius: 12px; text-align: center;">
      <div style="font-size: 3rem; margin-bottom: 1rem;">‚è≥</div>
      <p style="margin: 0; color: #2c5282; font-weight: bold;">Loading...</p>
    </div>
  );
}

// Main test component
component EdgeCase3ConditionalsPSR() {
  const [condition, setCondition] = useState<boolean>(true);
  const [showOptional, setShowOptional] = useState<boolean>(false);
  const [isLoading, setIsLoading] = useState<boolean>(false);
  const [captureResult, setCaptureResult] = useState<string>('');

  useEffect(() => {
    const rootEl = document.querySelector('[data-test-id="conditionals-root"]');
    if (rootEl) {
      const capture = captureRender(rootEl as HTMLElement, 'EdgeCase3ConditionalsPSR');
      const comparison = compareWithExpected(capture, {
        componentName: 'EdgeCase3ConditionalsPSR',
        assertions: {
          dom: {
            tagName: 'div',
            minChildren: 2,
            textContains: ['Conditional Rendering Test'],
          },
        },
      });
      
      setCaptureResult(comparison.passed ? '‚úÖ PASS' : `‚ùå FAIL: ${comparison.failures.join(', ')}`);
      console.log('[PSR Test] Conditionals Capture:', capture);
      console.log('[PSR Test] Comparison:', comparison);
    }
  });

  const toggleCondition = () => {
    setCondition(!condition());
  };

  const toggleOptional = () => {
    setShowOptional(!showOptional());
  };

  const simulateLoading = () => {
    setIsLoading(true);
    setTimeout(() => {
      setIsLoading(false);
    }, 2000);
  };

  return (
    <div data-test-id="conditionals-root" style="padding: 2rem; max-width: 800px; margin: 0 auto;">
      {/* Test Header */}
      <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 2rem; border-radius: 12px; color: white; margin-bottom: 2rem;">
        <h1 style="margin: 0 0 0.5rem; font-size: 2rem;">üîµ Test 3: Conditionals (PSR)</h1>
        <p style="margin: 0; opacity: 0.9;">Testing conditional rendering patterns in PSR</p>
        
        <div style="margin-top: 1rem; padding: 1rem; background: rgba(255,255,255,0.2); border-radius: 8px;">
          <strong>RenderCapture Status:</strong> {captureResult()}
        </div>
      </div>

      {/* Controls */}
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
        <button
          onClick={toggleCondition}
          style="padding: 1rem; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: transform 0.2s;"
          onMouseOver={(e: MouseEvent) => (e.currentTarget as HTMLElement).style.transform = 'scale(1.05)'}
          onMouseOut={(e: MouseEvent) => (e.currentTarget as HTMLElement).style.transform = 'scale(1)'}
        >
          Toggle A/B: {condition() ? 'A' : 'B'}
        </button>
        
        <button
          onClick={toggleOptional}
          style="padding: 1rem; background: #48bb78; color: white; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: transform 0.2s;"
          onMouseOver={(e: MouseEvent) => (e.currentTarget as HTMLElement).style.transform = 'scale(1.05)'}
          onMouseOut={(e: MouseEvent) => (e.currentTarget as HTMLElement).style.transform = 'scale(1)'}
        >
          Toggle Optional: {showOptional() ? 'ON' : 'OFF'}
        </button>

        <button
          onClick={simulateLoading}
          style="padding: 1rem; background: #4299e1; color: white; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: transform 0.2s;"
          onMouseOver={(e: MouseEvent) => (e.currentTarget as HTMLElement).style.transform = 'scale(1.05)'}
          onMouseOut={(e: MouseEvent) => (e.currentTarget as HTMLElement).style.transform = 'scale(1)'}
          disabled={isLoading()}
        >
          {isLoading() ? 'Loading...' : 'Simulate Load'}
        </button>
      </div>

      {/* Conditional Rendering Tests */}
      <div style="display: grid; gap: 2rem;">
        {/* Test 1: Ternary Conditional */}
        <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
          <h3 style="margin: 0 0 1rem; color: #2d3748;">Test 1: Ternary (condition ? A : B)</h3>
          {condition() ? <ComponentA /> : <ComponentB />}
        </div>

        {/* Test 2: Logical AND */}
        <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
          <h3 style="margin: 0 0 1rem; color: #2d3748;">Test 2: Logical AND (condition && Component)</h3>
          {showOptional() && (
            <div style="padding: 1.5rem; background: #faf089; border-radius: 8px; border-left: 4px solid #ecc94b;">
              <strong style="color: #744210;">üéØ Optional Content</strong>
              <p style="margin: 0.5rem 0 0; color: #744210;">
                This only renders when showOptional is TRUE
              </p>
            </div>
          )}
          {!showOptional() && (
            <p style="margin: 0; color: #a0aec0; font-style: italic;">
              Click "Toggle Optional" to show content
            </p>
          )}
        </div>

        {/* Test 3: Loading State */}
        <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
          <h3 style="margin: 0 0 1rem; color: #2d3748;">Test 3: Loading States</h3>
          {isLoading() ? (
            <LoadingSpinner />
          ) : (
            <div style="padding: 1.5rem; background: #c6f6d5; border-radius: 8px;">
              <strong style="color: #22543d;">‚úÖ Content Loaded</strong>
              <p style="margin: 0.5rem 0 0; color: #276749;">
                Click "Simulate Load" to see loading state
              </p>
            </div>
          )}
        </div>

        {/* Test 4: Nested Conditionals */}
        <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
          <h3 style="margin: 0 0 1rem; color: #2d3748;">Test 4: Nested Conditionals</h3>
          {condition() ? (
            showOptional() ? (
              <div style="padding: 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white;">
                <strong>üéâ Both Conditions TRUE</strong>
                <p style="margin: 0.5rem 0 0; opacity: 0.9;">
                  Condition A: ‚úÖ | Optional: ‚úÖ
                </p>
              </div>
            ) : (
              <div style="padding: 1.5rem; background: #bee3f8; border-radius: 8px; color: #2c5282;">
                <strong>Condition A TRUE, Optional FALSE</strong>
                <p style="margin: 0.5rem 0 0;">
                  Condition A: ‚úÖ | Optional: ‚ùå
                </p>
              </div>
            )
          ) : (
            <div style="padding: 1.5rem; background: #fed7d7; border-radius: 8px; color: #742a2a;">
              <strong>Condition A FALSE</strong>
              <p style="margin: 0.5rem 0 0;">
                Condition A: ‚ùå | Optional: {showOptional() ? '‚úÖ' : '‚ùå'}
              </p>
            </div>
          )}
        </div>
      </div>

      {/* What's Being Tested */}
      <div style="margin-top: 2rem; padding: 1.5rem; background: #edf2f7; border-radius: 12px;">
        <h3 style="margin: 0 0 1rem; color: #2d3748;">üß™ What's Being Tested:</h3>
        <ul style="margin: 0; padding-left: 1.5rem; color: #4a5568; line-height: 1.8;">
          <li>Ternary conditionals: <code>{`{condition() ? <A /> : <B />}`}</code></li>
          <li>Logical AND: <code>{`{condition() && <Component />}`}</code></li>
          <li>Negation: <code>{`{!condition() && <Other />}`}</code></li>
          <li>Nested conditionals (multiple levels)</li>
          <li>Loading states and transitions</li>
          <li>RenderCapture validation of conditional branches</li>
        </ul>
      </div>

      {/* Code Example */}
      <div style="margin-top: 2rem; padding: 1.5rem; background: #2d3748; border-radius: 12px; color: #e2e8f0; font-family: monospace; font-size: 0.9rem; overflow-x: auto;">
        <div style="color: #48bb78; margin-bottom: 0.5rem;">// PSR Conditional Patterns:</div>
        <div>{`{condition() ? <ComponentA /> : <ComponentB />}`}</div>
        <div>{`{showOptional() && <OptionalComponent />}`}</div>
        <div>{`{isLoading() ? <Loading /> : <Content />}`}</div>
      </div>
    </div>
  );
}

export { EdgeCase3ConditionalsPSR };
