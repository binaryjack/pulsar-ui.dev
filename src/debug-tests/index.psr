/**
 * Debug Test Suite - PSR Version
 * Testing PSR transformation with RenderCapture validation
 */

import { useState } from '@pulsar-framework/pulsar.dev';
import { EdgeCase1ArrayMapPSR } from './edge-case-1-array-map.psr';
import { EdgeCase2NestedComponentsPSR } from './edge-case-2-nested-components.psr';
import { EdgeCase3ConditionalsPSR } from './edge-case-3-conditionals.psr';

type TestCase = 'home' | 'array-map' | 'nested-components' | 'conditionals';

component DebugTestSuitePSR() {
  const [activeTest, setActiveTest] = useState<TestCase>('home');

  const renderTest = () => {
    const test = activeTest();

    if (test === 'array-map') return EdgeCase1ArrayMapPSR();
    if (test === 'nested-components') return EdgeCase2NestedComponentsPSR();
    if (test === 'conditionals') return EdgeCase3ConditionalsPSR();

    // Home screen
    return (
      <div style="padding: 2rem; max-width: 1000px; margin: 0 auto; font-family: system-ui;">
        <div style="text-align: center; margin-bottom: 3rem;">
          <h1 style="margin: 0; font-size: 3rem; color: #2d3748; margin-bottom: 0.5rem;">
            ğŸ¯ PSR Transformation Test Suite
          </h1>
          <p style="margin: 0; font-size: 1.2rem; color: #718096;">
            Proving PSR â†’ JavaScript â†’ DOM works end-to-end
          </p>
          <p style="margin-top: 1rem; font-size: 0.9rem; color: #4299e1; font-weight: 600;">
            âœ¨ All components written in .psr syntax
          </p>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
          {/* Test Case 1 - Array Mapping */}
          <div
            onClick={() => setActiveTest('array-map')}
            style="padding: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"
            onMouseOver={(e: MouseEvent) => {
              (e.currentTarget as HTMLElement).style.transform = 'translateY(-4px)';
            }}
            onMouseOut={(e: MouseEvent) => {
              (e.currentTarget as HTMLElement).style.transform = 'translateY(0)';
            }}
          >
            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”´</div>
            <h2 style="margin: 0 0 0.5rem; color: white; font-size: 1.5rem;">Test 1: Array Mapping</h2>
            <p style="margin: 0; color: rgba(255,255,255,0.9); font-size: 0.95rem;">
              PSR array.map() with reactive signals
            </p>
            <div style="margin-top: 1rem; padding: 0.5rem; background: rgba(255,255,255,0.2); border-radius: 6px;">
              <code style="color: white; font-size: 0.85rem;">
                {`items().map(item => <div>{item}</div>)`}
              </code>
            </div>
          </div>

          {/* Test Case 2 - Nested Components */}
          <div
            onClick={() => setActiveTest('nested-components')}
            style="padding: 2rem; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"
            onMouseOver={(e: MouseEvent) => {
              (e.currentTarget as HTMLElement).style.transform = 'translateY(-4px)';
            }}
            onMouseOut={(e: MouseEvent) => {
              (e.currentTarget as HTMLElement).style.transform = 'translateY(0)';
            }}
          >
            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸŸ </div>
            <h2 style="margin: 0 0 0.5rem; color: white; font-size: 1.5rem;">Test 2: Nested Components</h2>
            <p style="margin: 0; color: rgba(255,255,255,0.9); font-size: 0.95rem;">
              PSR component composition
            </p>
            <div style="margin-top: 1rem; padding: 0.5rem; background: rgba(255,255,255,0.2); border-radius: 6px;">
              <code style="color: white; font-size: 0.85rem;">
                {`<Parent><Child><GrandChild /></Child></Parent>`}
              </code>
            </div>
          </div>

          {/* Test Case 3 - Conditionals */}
          <div
            onClick={() => setActiveTest('conditionals')}
            style="padding: 2rem; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 12px; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"
            onMouseOver={(e: MouseEvent) => {
              (e.currentTarget as HTMLElement).style.transform = 'translateY(-4px)';
            }}
            onMouseOut={(e: MouseEvent) => {
              (e.currentTarget as HTMLElement).style.transform = 'translateY(0)';
            }}
          >
            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”µ</div>
            <h2 style="margin: 0 0 0.5rem; color: white; font-size: 1.5rem;">Test 3: Conditionals</h2>
            <p style="margin: 0; color: rgba(255,255,255,0.9); font-size: 0.95rem;">
              PSR conditional rendering
            </p>
            <div style="margin-top: 1rem; padding: 0.5rem; background: rgba(255,255,255,0.2); border-radius: 6px;">
              <code style="color: white; font-size: 0.85rem;">
                {`{condition() ? <A /> : <B />}`}
              </code>
            </div>
          </div>
        </div>

        <div style="padding: 2rem; background: #f7fafc; border-radius: 12px; border-left: 4px solid #4299e1;">
          <h3 style="margin: 0 0 1rem; color: #2d3748; font-size: 1.3rem;">
            ğŸ¯ What We're Testing
          </h3>
          <ul style="margin: 0; padding-left: 1.5rem; color: #4a5568; line-height: 1.8;">
            <li><strong>PSR Syntax:</strong> component keyword, useState(), useEffect()</li>
            <li><strong>Transformation:</strong> PSR â†’ JavaScript â†’ t_element calls</li>
            <li><strong>Runtime:</strong> Does transformed code execute in browser?</li>
            <li><strong>Reactivity:</strong> Do signals trigger DOM updates?</li>
            <li><strong>RenderCapture:</strong> Validating output matches expectations</li>
          </ul>
        </div>

        <div style="margin-top: 2rem; padding: 1.5rem; background: #fff5f5; border-radius: 12px; border-left: 4px solid #f56565;">
          <h4 style="margin: 0 0 0.5rem; color: #c53030; font-size: 1.1rem;">
            âš ï¸ Critical Test
          </h4>
          <p style="margin: 0; color: #742a2a; line-height: 1.6;">
            If these tests pass, PSR transformation is <strong>production-ready</strong>. 
            If they fail, we know exactly where the pipeline breaks.
          </p>
        </div>
      </div>
    );
  };

  return (
    <div>
      {renderTest()}
      
      {/* Back button when not on home */}
      {activeTest() !== 'home' && (
        <div style="position: fixed; bottom: 2rem; left: 2rem;">
          <button
            onClick={() => setActiveTest('home')}
            style="padding: 1rem 2rem; background: #4299e1; color: white; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4); transition: transform 0.2s;"
            onMouseOver={(e: MouseEvent) => {
              (e.currentTarget as HTMLElement).style.transform = 'scale(1.05)';
            }}
            onMouseOut={(e: MouseEvent) => {
              (e.currentTarget as HTMLElement).style.transform = 'scale(1)';
            }}
          >
            â† Back to Tests
          </button>
        </div>
      )}
    </div>
  );
}

export { DebugTestSuitePSR };
