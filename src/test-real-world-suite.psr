/**
 * Real-World UI Test Suite - PSR Components
 * 
 * Comprehensive test suite for Pulsar transformer testing:
 * - Declarative components only (return JSX pattern)
 * - Full reactivity with signals
 * - Event handlers and user interactions
 * - Real-world UI patterns
 * - Visual validation
 */

import { 
  createSignal, 
  createEffect, 
  createMemo,
  bootstrapApp 
} from '@pulsar-framework/pulsar.dev';

// ============================================================================
// TEST 1: Simple Declarative Button
// ============================================================================

const SimpleButton = () => {
  const [clicks, setClicks] = createSignal(0);
  
  return (
    <div style="padding: 20px; border: 2px solid #ccc; margin-bottom: 20px; border-radius: 8px;">
      <h3>‚úÖ Test 1: Simple Declarative Button</h3>
      <p>Clicks: {clicks()}</p>
      <button 
        onClick={() => setClicks(clicks() + 1)}
        style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;"
      >
        Click Me ({clicks()})
      </button>
    </div>
  );
};

// ============================================================================
// TEST 2: Multiple Signals (Counter with Min/Max)
// ============================================================================

const BoundedCounter = () => {
  const [count, setCount] = createSignal(0);
  const [min] = createSignal(0);
  const [max] = createSignal(10);
  
  const increment = () => {
    if (count() < max()) {
      setCount(count() + 1);
    }
  };
  
  const decrement = () => {
    if (count() > min()) {
      setCount(count() - 1);
    }
  };
  
  const atMin = () => count() === min();
  const atMax = () => count() === max();
  
  return (
    <div style="padding: 20px; border: 2px solid #ccc; margin-bottom: 20px; border-radius: 8px;">
      <h3>‚úÖ Test 2: Bounded Counter (0-10)</h3>
      <div style="font-size: 32px; margin: 15px 0;">Count: {count()}</div>
      <div style="display: flex; gap: 10px;">
        <button 
          onClick={decrement}
          disabled={atMin()}
          style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;"
        >
          ‚ûñ Decrement
        </button>
        <button 
          onClick={() => setCount(5)}
          style="padding: 10px 20px; background: #ffc107; color: #000; border: none; border-radius: 4px; cursor: pointer;"
        >
          üîÑ Reset to 5
        </button>
        <button 
          onClick={increment}
          disabled={atMax()}
          style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;"
        >
          ‚ûï Increment
        </button>
      </div>
      <p style="margin-top: 10px; color: #666;">
        {atMin() ? '‚ö†Ô∏è At minimum' : atMax() ? '‚ö†Ô∏è At maximum' : '‚úÖ In range'}
      </p>
    </div>
  );
};

// ============================================================================
// TEST 3: Text Input with Live Preview
// ============================================================================

const TextInputLive = () => {
  const [text, setText] = createSignal('');
  const [wordCount, setWordCount] = createSignal(0);
  
  const handleInput = (e) => {
    const value = e.target.value;
    setText(value);
    const words = value.trim().split(/\s+/).filter(w => w.length > 0);
    setWordCount(words.length);
  };
  
  return (
    <div style="padding: 20px; border: 2px solid #ccc; margin-bottom: 20px; border-radius: 8px;">
      <h3>‚úÖ Test 3: Live Text Input</h3>
      <input
        type="text"
        value={text()}
        onInput={handleInput}
        placeholder="Type something..."
        style="width: 100%; padding: 10px; margin: 10px 0; font-size: 16px; border: 2px solid #ddd; border-radius: 4px;"
      />
      <div style="margin-top: 10px;">
        <p><strong>Characters:</strong> {text().length}</p>
        <p><strong>Words:</strong> {wordCount()}</p>
        <p><strong>Preview:</strong> {text() || '(empty)'}</p>
      </div>
    </div>
  );
};

// ============================================================================
// TEST 4: Toggle with Conditional Rendering
// ============================================================================

const TogglePanel = () => {
  const [isOpen, setIsOpen] = createSignal(false);
  const [count, setCount] = createSignal(0);
  
  return (
    <div style="padding: 20px; border: 2px solid #ccc; margin-bottom: 20px; border-radius: 8px;">
      <h3>‚úÖ Test 4: Toggle with Conditional Content</h3>
      <button 
        onClick={() => setIsOpen(!isOpen())}
        style="padding: 10px 20px; background: #6f42c1; color: white; border: none; border-radius: 4px; cursor: pointer; margin-bottom: 10px;"
      >
        {isOpen() ? '‚ñº Hide' : '‚ñ∂ Show'} Panel
      </button>
      
      {isOpen() && (
        <div style="padding: 15px; background: #f8f9fa; border-radius: 4px; margin-top: 10px;">
          <p>‚ú® This content is conditionally rendered!</p>
          <p>Internal counter: {count()}</p>
          <button 
            onClick={() => setCount(count() + 1)}
            style="padding: 8px 16px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 8px;"
          >
            Increment Internal Counter
          </button>
        </div>
      )}
    </div>
  );
};

// ============================================================================
// TEST 5: Form with Multiple Inputs
// ============================================================================

const UserForm = () => {
  const [firstName, setFirstName] = createSignal('');
  const [lastName, setLastName] = createSignal('');
  const [email, setEmail] = createSignal('');
  const [submitted, setSubmitted] = createSignal(false);
  
  const isValid = () => {
    return firstName().length > 0 && 
           lastName().length > 0 && 
           email().includes('@');
  };
  
  const handleSubmit = (e) => {
    e.preventDefault();
    if (isValid()) {
      setSubmitted(true);
      setTimeout(() => setSubmitted(false), 3000);
    }
  };
  
  return (
    <div style="padding: 20px; border: 2px solid #ccc; margin-bottom: 20px; border-radius: 8px;">
      <h3>‚úÖ Test 5: Multi-Input Form</h3>
      <form onSubmit={handleSubmit}>
        <div style="margin-bottom: 10px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">First Name:</label>
          <input
            type="text"
            value={firstName()}
            onInput={(e) => setFirstName(e.target.value)}
            placeholder="First name"
            style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 4px;"
          />
        </div>
        
        <div style="margin-bottom: 10px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">Last Name:</label>
          <input
            type="text"
            value={lastName()}
            onInput={(e) => setLastName(e.target.value)}
            placeholder="Last name"
            style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 4px;"
          />
        </div>
        
        <div style="margin-bottom: 10px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">Email:</label>
          <input
            type="email"
            value={email()}
            onInput={(e) => setEmail(e.target.value)}
            placeholder="email@example.com"
            style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 4px;"
          />
        </div>
        
        <button
          type="submit"
          disabled={!isValid()}
          style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;"
        >
          Submit Form
        </button>
      </form>
      
      {submitted() && (
        <div style="margin-top: 15px; padding: 10px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 4px; color: #155724;">
          ‚úÖ Form submitted! Name: {firstName()} {lastName()}, Email: {email()}
        </div>
      )}
    </div>
  );
};

// ============================================================================
// TEST 6: Dynamic List with Add/Remove
// ============================================================================

const TodoList = () => {
  const [todos, setTodos] = createSignal([]);
  const [input, setInput] = createSignal('');
  const [nextId, setNextId] = createSignal(1);
  
  const addTodo = () => {
    if (input().trim()) {
      const newTodo = { id: nextId(), text: input(), done: false };
      setTodos([...todos(), newTodo]);
      setNextId(nextId() + 1);
      setInput('');
    }
  };
  
  const removeTodo = (id) => {
    setTodos(todos().filter(todo => todo.id !== id));
  };
  
  const toggleTodo = (id) => {
    setTodos(todos().map(todo => 
      todo.id === id ? { ...todo, done: !todo.done } : todo
    ));
  };
  
  return (
    <div style="padding: 20px; border: 2px solid #ccc; margin-bottom: 20px; border-radius: 8px;">
      <h3>‚úÖ Test 6: Dynamic Todo List</h3>
      <div style="display: flex; gap: 10px; margin-bottom: 15px;">
        <input
          type="text"
          value={input()}
          onInput={(e) => setInput(e.target.value)}
          onKeyPress={(e) => e.key === 'Enter' && addTodo()}
          placeholder="Add a todo..."
          style="flex: 1; padding: 8px; border: 2px solid #ddd; border-radius: 4px;"
        />
        <button
          onClick={addTodo}
          disabled={!input().trim()}
          style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;"
        >
          Add
        </button>
      </div>
      
      <div>
        <p style="margin-bottom: 10px;">Total: {todos().length} todos</p>
        {todos().length === 0 ? (
          <p style="color: #999; font-style: italic;">No todos yet. Add one above!</p>
        ) : (
          <ul style="list-style: none; padding: 0;">
            {todos().map(todo => (
              <li 
                key={todo.id}
                style="padding: 10px; margin-bottom: 8px; background: #f8f9fa; border-radius: 4px; display: flex; align-items: center; justify-content: space-between;"
              >
                <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                  <input
                    type="checkbox"
                    checked={todo.done}
                    onChange={() => toggleTodo(todo.id)}
                    style="width: 18px; height: 18px; cursor: pointer;"
                  />
                  <span style="text-decoration: none; color: #000;">
                    {todo.text}
                  </span>
                </div>
                <button
                  onClick={() => removeTodo(todo.id)}
                  style="padding: 4px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;"
                >
                  Delete
                </button>
              </li>
            ))}
          </ul>
        )}
      </div>
    </div>
  );
};

// ============================================================================
// TEST 7: Tabs Component
// ============================================================================

const Tabs = () => {
  const [activeTab, setActiveTab] = createSignal(0);
  
  const tabs = [
    { label: 'Profile', content: 'üë§ User profile information goes here' },
    { label: 'Settings', content: '‚öôÔ∏è Application settings panel' },
    { label: 'History', content: 'üìú Activity history and logs' }
  ];
  
  return (
    <div style="padding: 20px; border: 2px solid #ccc; margin-bottom: 20px; border-radius: 8px;">
      <h3>‚úÖ Test 7: Tab Navigation</h3>
      <div style="display: flex; gap: 5px; border-bottom: 2px solid #dee2e6; margin-bottom: 15px;">
        {tabs.map((tab, index) => (
          <button
            key={index}
            onClick={() => setActiveTab(index)}
            style="padding: 10px 20px; background: #007bff; color: white; border: none; border-bottom: 3px solid #007bff; cursor: pointer; font-weight: bold;"
          >
            {tab.label}
          </button>
        ))}
      </div>
      <div style="padding: 20px; background: #f8f9fa; border-radius: 4px;">
        {tabs[activeTab()].content}
      </div>
    </div>
  );
};

// ============================================================================
// TEST 8: Modal Dialog
// ============================================================================

const ModalDemo = () => {
  const [isOpen, setIsOpen] = createSignal(false);
  const [message, setMessage] = createSignal('');
  
  const openModal = () => {
    setMessage(`Modal opened at ${new Date().toLocaleTimeString()}`);
    setIsOpen(true);
  };
  
  return (
    <div style="padding: 20px; border: 2px solid #ccc; margin-bottom: 20px; border-radius: 8px;">
      <h3>‚úÖ Test 8: Modal Dialog</h3>
      <button
        onClick={openModal}
        style="padding: 10px 20px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer;"
      >
        Open Modal
      </button>
      
      {isOpen() && (
        <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;">
          <div style="background: white; padding: 30px; border-radius: 8px; min-width: 400px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);">
            <h4 style="margin-top: 0;">Modal Dialog</h4>
            <p>{message()}</p>
            <p style="color: #666;">This is a modal overlay. Click close to dismiss.</p>
            <button
              onClick={() => setIsOpen(false)}
              style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 15px;"
            >
              Close Modal
            </button>
          </div>
        </div>
      )}
    </div>
  );
};

// ============================================================================
// MAIN APP - Renders All Tests
// ============================================================================

const App = () => {
  return (
    <div style="max-width: 1000px; margin: 0 auto; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
      <h1 style="text-align: center; color: #333; margin-bottom: 10px;">
        üöÄ Pulsar PSR Real-World Test Suite
      </h1>
      <p style="text-align: center; color: #666; margin-bottom: 30px;">
        Testing declarative components, reactivity, and real-world UI patterns
      </p>
      
      <SimpleButton />
      <BoundedCounter />
      <TextInputLive />
      <TogglePanel />
      <UserForm />
      <TodoList />
      <Tabs />
      <ModalDemo />
      
      <div style="margin-top: 40px; padding: 20px; background: #d4edda; border: 2px solid #c3e6cb; border-radius: 8px; text-align: center;">
        <h3 style="color: #155724; margin-top: 0;">‚úÖ All Tests Loaded</h3>
        <p style="color: #155724;">
          If you can see all components rendering and interacting correctly, 
          the PSR transformation is working! üéâ
        </p>
      </div>
    </div>
  );
};

// Bootstrap the app
bootstrapApp()
  .root('#app')
  .build()
  .mount(App());
