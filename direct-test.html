<!doctype html>
<html>
  <head>
    <title>BYPASS BOOTSTRAP - DIRECT TEST</title>
    <style>
      body {
        background: #000;
        color: #0f0;
        padding: 20px;
        font-family: monospace;
      }
      .log {
        margin: 2px 0;
      }
      .error {
        color: #f00;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>BYPASS BOOTSTRAP - CALL AVATARTEST() DIRECTLY</h1>
    <div id="logs"></div>
    <hr />
    <div id="app" style="border: 2px solid red; padding: 20px; min-height: 200px"></div>

    <script type="module">
      const logs = document.getElementById('logs');
      const log = (msg, isError = false) => {
        const div = document.createElement('div');
        div.className = 'log' + (isError ? ' error' : '');
        div.textContent = msg;
        logs.appendChild(div);
        console.log(msg);
      };

      log('▶ STARTING DIRECT TEST');

      try {
        log('1. Importing AvatarTest...');
        const { AvatarTest } = await import('./src/test-psr-avatar.psr');
        log(`2. ✅ AvatarTest type: ${typeof AvatarTest}`);

        log('3. Calling AvatarTest() directly...');
        const result = AvatarTest();

        log(`4. ✅ Result type: ${typeof result}`);
        log(`5. Result: ${result}`);
        log(`6. Result constructor: ${result?.constructor?.name}`);
        log(`7. Has nodeType: ${result?.nodeType !== undefined}`);
        log(`8. nodeType value: ${result?.nodeType}`);
        log(`9. Has tagName: ${result?.tagName !== undefined}`);
        log(`10. tagName: ${result?.tagName}`);

        if (result && result.nodeType === 1) {
          log('11. ✅ Result IS a DOM Element (nodeType=1)');
          log('12. Appending to #app...');
          document.getElementById('app').appendChild(result);
          log('13. ✅ APPENDED! You should see content in the red box.');
        } else if (result && result.nodeType) {
          log(`11. ⚠️  Result has nodeType=${result.nodeType} but not 1 (Element)`, true);
        } else if (result) {
          log('11. ❌ Result is NOT a DOM node', true);
          log(`    Result is: ${JSON.stringify(result, null, 2)}`, true);
        } else {
          log('11. ❌ Result is null/undefined', true);
        }
      } catch (err) {
        log(`❌ ERROR: ${err.message}`, true);
        log(`Stack: ${err.stack}`, true);
      }
    </script>
  </body>
</html>
